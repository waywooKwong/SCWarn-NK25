# Sock Shop JMeter 性能测试

本目录包含用于对Sock Shop微服务演示应用进行性能测试的JMeter测试计划和相关脚本。

## 测试内容

测试计划模拟了典型用户在电子商务网站上的行为：

1. 访问首页
2. 浏览商品目录
3. 查看单个商品详情
4. 添加商品到购物车
5. 查看购物车
6. 用户注册和登录
7. 搜索和筛选商品

## 测试计划文件说明

项目中包含两个测试计划文件，分别针对不同的测试场景：

- `sockshop_test_plan.jmx`: 主要测试计划，包含浏览、购物车、搜索和压力测试场景。这个测试计划主要关注普通用户的浏览和购物体验，测试网站的基本功能。

- `user_test_plan.jmx`: 专门的用户注册和登录测试计划。这个测试计划专注于用户账户相关功能，包含更多与用户身份验证相关的测试场景和特殊的HTTP请求头设置。

将用户测试分离为单独的测试计划有以下好处：

1. **关注点分离**：用户认证功能通常需要特殊的请求头和Cookie管理，分离后可以更专注于这些细节
2. **独立测试**：可以单独测试用户注册/登录功能，不受其他功能测试的影响
3. **并发控制**：用户注册和登录通常需要不同的并发用户数和测试参数
4. **数据管理**：用户测试需要生成唯一用户名和密码，使用专门的测试计划可以更好地管理这些测试数据

## 前提条件

- 已安装 Apache JMeter（建议5.0或更高版本）
- Sock Shop应用已在本地或远程服务器上部署并运行
- 确保Sock Shop应用的端口可访问

## 使用方法

### 运行测试

使用提供的脚本可以直接通过命令行运行测试并生成HTML报告：

1. 确保`run_test.sh`脚本有执行权限：
   ```
   chmod +x run_test.sh
   ```

2. 运行测试（使用默认参数）：
   ```
   ./run_test.sh
   ```

3. 使用自定义参数运行测试：
   ```
   ./run_test.sh -h <主机名> -p <端口> -t <并发用户数> -r <爬升时间> -l <循环次数> -d <测试时长> -J <JMeter路径>
   ```

   参数说明：
   - `-h` : 目标主机地址（默认为localhost）
   - `-p` : 目标主机端口（默认为80）
   - `-P` : 使用的协议（默认为http）
   - `-t` : 并发用户数（默认为10）
   - `-r` : 爬升时间，单位为秒（默认为10）
   - `-l` : 循环次数（默认为1）
   - `-d` : 测试持续时间，单位为秒（默认为300）
   - `-J` : JMeter安装路径（默认为/opt/apache-jmeter）
   - `-f` : 指定要运行的测试计划文件（默认为sockshop_test_plan.jmx）

   示例：
   ```
   # 针对在192.168.1.100上部署的Sock Shop，使用50个并发用户进行测试
   ./run_test.sh -h 192.168.1.100 -p 80 -t 50 -r 30 -d 600
   ```

4. 运行特定测试计划：
   ```
   # 运行主测试计划
   ./run_test.sh -f sockshop_test_plan.jmx -h localhost -p 8080
   
   # 运行用户测试计划
   ./run_test.sh -f user_test_plan.jmx -h localhost -p 8080
   ```

## 查看测试结果

每次测试完成后，会在以下目录中生成带有时间戳的测试结果和报告：

- 结果数据：`results/<测试计划名称>_<时间戳>/`
- HTML报告：`report/<测试计划名称>_<时间戳>/`

这样设计可以确保不同测试计划或多次运行同一测试计划的结果不会相互覆盖。

### 查看最新报告

为了方便访问最新的测试报告，脚本会创建指向最新报告的软链接：

- 最新结果数据：`latest_results/`
- 最新HTML报告：`latest_report/`

可以直接在浏览器中打开 `latest_report/index.html` 查看最新的测试报告。

### 报告内容

测试报告包含以下信息：

- 响应时间统计
- 吞吐量统计
- 错误率
- 各API端点的性能指标
- 性能趋势图表

## 故障排查

- 确保 JMeter 已正确安装，可通过运行 `jmeter -v` 验证
- 确保 Sock Shop 应用正在运行并可访问
- 如果使用 Kubernetes 部署，可能需要设置端口转发：
  ```bash
  kubectl port-forward svc/front-end 8080:80
  ```
- 如果测试报告无法生成，确保JMeter有足够的堆内存：
  ```
  export JVM_ARGS="-Xms1g -Xmx2g"
  ```
- 查看测试日志获取详细错误信息

## 自定义测试

如需自定义测试场景，可以：

1. 修改并发用户数和爬升时间来模拟不同的负载情况
2. 调整循环次数和测试持续时间来控制测试的长度
3. 添加更多的HTTP请求来测试其他功能
4. 修改定时器的延迟时间来模拟更真实的用户行为
5. 添加更多断言来验证响应内容的正确性

## 高级用法

- 可以修改测试计划以添加更多的微服务API端点测试
- 可以通过JMeter属性配置文件来设置更多参数 